---
- name: check if {{ item }} is present
  ansible.builtin.stat:
    path: "{{ item }}"
  register: result

- name: add new parameter
  block:
    - name: check if {{ item }} is the right file
      ansible.builtin.lineinfile:
        path: "{{ item }}"
        line: "DO NOT EDIT THIS FILE"
        state: "present"
      check_mode: true
      register: presence
      changed_when: false

    - name: add new parameter to {{ item }}
      ansible.builtin.lineinfile:
        path: "{{ item }}"
        line: "dtoverlay=pwm-2chan"
      when: (presence.msg is defined) and (presence.msg == "line added")
  when: (result.stat.isreg is defined) and (result.stat.isreg)

